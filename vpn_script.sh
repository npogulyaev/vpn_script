#!/bin/bash

# Конфигурация
PING_TARGET="10.8.0.1"  # IP-адрес для проверки подключения
RETRY_LIMIT=5          # Количество неудачных попыток перед остановкой
RETRY_DELAY=10         # Время задержки между попытками, в секундах
RESTART_COMMAND="sudo reboot"  # Команда для перезапуска устройства

# Переменные для отслеживания состояния
retry_count=0

while true; do
    # Проверяем наличие сети, отправляя ping
    if ping -c 1 -W 2 $PING_TARGET > /dev/null; then
        echo "Сеть доступна."
        retry_count=0  # Сбрасываем счетчик при успешном подключении
    else
        echo "Сеть недоступна, попытка восстановления..."

        # Увеличиваем счетчик попыток
        ((retry_count++))

        # Проверяем, достиг ли счетчик лимита
        if ((retry_count >= RETRY_LIMIT)); then
            echo "Превышено количество попыток восстановления сети. Сценарий завершен."
            exit 1
        fi

        # Перезапускаем устройство
        echo "Перезапуск устройства..."
        $RESTART_COMMAND
    fi

    # Задержка перед следующей проверкой
    sleep $RETRY_DELAY
done


